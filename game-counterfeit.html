<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counterfeit - DATOV</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
            background: rgba(21, 23, 37, 0.5);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 800px;
            margin: 0 auto;
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 1.2rem;
            font-weight: 600;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-sm);
        }

        .timer-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: -1rem;
        }

        .timer-fill {
            height: 100%;
            background: var(--primary);
            width: 100%;
            transition: width 0.1s linear;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 1rem;
            width: 100%;
            justify-items: center;
        }

        .item {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            border: 2px solid transparent;
        }

        .item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }

        .item.correct {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .item.wrong {
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
            animation: shake 0.4s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        .message {
            font-size: 1.5rem;
            min-height: 2rem;
            text-align: center;
            color: var(--primary);
        }

        .accessibility-toggle {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .accessibility-toggle input {
            accent-color: var(--primary);
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="container flex flex-between">
            <a href="index.html" class="logo">DATOV</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html#games">Back to Games</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section" style="padding-top: 8rem;">
        <div class="container">
            <div class="game-container">
                <div class="stats-bar">
                    <span id="scoreDisplay">Score: 0</span>
                    <span id="levelDisplay">Level: 1</span>
                </div>
                <div class="timer-bar">
                    <div id="timerFill" class="timer-fill"></div>
                </div>

                <div id="message" class="message">Find the odd one out!</div>

                <div id="grid" class="items-grid">
                    <!-- Items generated by JS -->
                </div>

                <label class="accessibility-toggle">
                    <input type="checkbox" id="cbMode"> Color Blind Mode (High Contrast)
                </label>

                <button id="startBtn" class="btn btn-primary" style="margin-top: 1rem;">Start Game</button>
            </div>
        </div>
    </section>

    <script src="game-interface.js"></script>
    <script>
        const ICONS = ['fa-ghost', 'fa-gamepad', 'fa-rocket', 'fa-puzzle-piece', 'fa-gem', 'fa-heart', 'fa-star', 'fa-bolt'];
        const COLORS = ['#00f3ff', '#ff00ff', '#7000ff', '#00ff00', '#ffff00', '#ff0000'];

        let score = 0;
        let level = 1;
        let timeLeft = 10;
        let timerInterval;
        let isPlaying = false;
        let colorBlindMode = false;

        const grid = document.getElementById('grid');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const timerFill = document.getElementById('timerFill');
        const message = document.getElementById('message');
        const startBtn = document.getElementById('startBtn');
        const cbToggle = document.getElementById('cbMode');

        cbToggle.addEventListener('change', (e) => {
            colorBlindMode = e.target.checked;
            if (isPlaying) generateLevel();
        });

        startBtn.addEventListener('click', startGame);

        // Init Interface
        GameInterface.init({
            name: 'Counterfeit',
            description: 'Spot the fake item! One of these is not like the others.',
            howToPlay: [
                'Look at the grid of items.',
                'Find the one that is slightly different (color or rotation).',
                'Click it before time runs out!',
                'Correct answers give points and time.',
                'Wrong answers deduct points.'
            ]
        });

        function startGame() {
            score = 0;
            level = 1;
            isPlaying = true;
            startBtn.style.display = 'none';
            updateStats();
            generateLevel();
        }

        function updateStats() {
            scoreDisplay.textContent = `Score: ${score}`;
            levelDisplay.textContent = `Level: ${level}`;
        }

        function generateLevel() {
            grid.innerHTML = '';
            message.textContent = "Find the odd one out!";

            // Difficulty scaling
            const gridSize = Math.min(16, 4 + Math.floor(level / 2)); // Max 16 items
            const baseIcon = ICONS[Math.floor(Math.random() * ICONS.length)];
            const baseColor = COLORS[Math.floor(Math.random() * COLORS.length)];

            // Determine the "fake" property (rotation or color)
            // For color blind mode, we rely more on rotation or shape
            const diffType = (Math.random() > 0.5 && !colorBlindMode) ? 'color' : 'rotation';

            const fakeIndex = Math.floor(Math.random() * gridSize);

            for (let i = 0; i < gridSize; i++) {
                const item = document.createElement('div');
                item.className = 'item';

                const icon = document.createElement('i');
                icon.className = `fas ${baseIcon}`;

                // Base styles
                icon.style.color = baseColor;
                icon.style.transform = 'rotate(0deg)';

                if (i === fakeIndex) {
                    item.dataset.fake = 'true';

                    if (diffType === 'color') {
                        // Slightly different color
                        // Simple hue shift logic or opacity
                        icon.style.opacity = '0.5';
                    } else {
                        // Rotation
                        icon.style.transform = 'rotate(45deg)';
                    }
                }

                item.appendChild(icon);
                item.addEventListener('click', handleItemClick);
                grid.appendChild(item);
            }

            resetTimer();
        }

        function handleItemClick(e) {
            if (!isPlaying) return;

            const item = e.currentTarget;
            if (item.dataset.fake === 'true') {
                // Correct
                score += 10 * level;
                level++;
                item.classList.add('correct');
                message.textContent = "Correct!";
                message.style.color = "#00ff00";

                setTimeout(() => {
                    message.style.color = "var(--primary)";
                    updateStats();
                    generateLevel();
                }, 500);
            } else {
                // Wrong
                item.classList.add('wrong');
                score = Math.max(0, score - 5);
                updateStats();
                message.textContent = "Wrong! Try again.";
                message.style.color = "#ff0000";
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timeLeft = Math.max(3, 10 - (level * 0.5)); // Decrease time as levels go up

            timerFill.style.width = '100%';

            const totalTime = timeLeft;

            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                const pct = (timeLeft / totalTime) * 100;
                timerFill.style.width = `${pct}%`;

                if (timeLeft <= 0) {
                    gameOver();
                }
            }, 100);
        }

        function gameOver() {
            clearInterval(timerInterval);
            isPlaying = false;
            grid.innerHTML = '';
            message.textContent = `Game Over! Final Score: ${score}`;
            message.style.color = "var(--secondary)";
            startBtn.textContent = "Play Again";
            startBtn.style.display = 'block';

            GameInterface.showGameOver({
                score: score,
                level: level,
                text: 'Game Over'
            });
        }

    </script>
</body>

</html>