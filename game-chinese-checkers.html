<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Checkers - DATOV</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
            background: rgba(21, 23, 37, 0.5);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 600px;
            margin: 0 auto;
        }

        .board-container {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            /* Aspect ratio 1:1 */
        }

        .board {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hole {
            position: absolute;
            width: 6%;
            height: 6%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.2s;
        }

        .hole:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hole.highlight {
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 5px #00ff00;
        }

        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            margin: 10%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }

        .piece.p1 {
            background: #00f3ff;
            box-shadow: 0 0 5px #00f3ff;
        }

        .piece.p2 {
            background: #ff00ff;
            box-shadow: 0 0 5px #ff00ff;
        }

        .piece.selected {
            transform: scale(1.2);
            box-shadow: 0 0 15px #fff;
        }

        .turn-indicator {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .turn-p1 {
            color: #00f3ff;
        }

        .turn-p2 {
            color: #ff00ff;
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="container flex flex-between">
            <a href="index.html" class="logo">DATOV</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html#games">Back to Games</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section" style="padding-top: 8rem;">
        <div class="container">
            <div class="game-container">
                <div class="turn-indicator" id="turnIndicator">Player 1's Turn</div>

                <div class="board-container">
                    <div class="board" id="board">
                        <!-- Holes generated by JS -->
                    </div>
                </div>

                <button id="resetBtn" class="btn btn-primary">Reset Game</button>
            </div>
        </div>
    </section>

    <script src="game-interface.js"></script>
    <script>
        // Simplified Chinese Checkers (Diamond shape or Star subset for 2 players)
        
        const boardEl = document.getElementById('board');
        const turnIndicator = document.getElementById('turnIndicator');

        let holes = []; // {q, r, x, y, el, piece: 0|1|2}
        let currentPlayer = 1;
        let selectedHole = null;

        // Initialize Game Interface
        GameInterface.init({
            name: 'Chinese Checkers',
            description: 'A classic strategy game. Move your pieces to the opposite side of the board before your opponent does.',
            url: 'game-chinese-checkers.html',
            howToPlay: [
                'Click a piece to select it.',
                'Click an empty adjacent hole to move.',
                'You can jump over other pieces to move further.',
                'The goal is to move all your pieces to the opposite triangle.'
            ]
        });

        // Radius of the star (center to tip) = 4
        const RADIUS = 4;

        function initBoard() {
            holes = [];
            boardEl.innerHTML = '';

            // Hexagon Radius 3
            const HEX_RADIUS = 3;
            for (let q = -HEX_RADIUS; q <= HEX_RADIUS; q++) {
                for (let r = -HEX_RADIUS; r <= HEX_RADIUS; r++) {
                    if (Math.abs(-q - r) <= HEX_RADIUS) {
                        createHole(q, r);
                    }
                }
            }

            // Place pieces
            // P2 starts at top (r <= -2)
            // P1 starts at bottom (r >= 2)
            holes.forEach(h => {
                if (h.r <= -2) {
                    h.piece = 2; 
                }
                else if (h.r >= 2) {
                    h.piece = 1; 
                } else {
                    h.piece = 0;
                }
            });

            renderPieces();
        }

        function createHole(q, r) {
            // Better Hex to Pixel:
            // x = 50 + 7 * (q + r/2)
            // y = 50 + 7 * (r * 0.866)

            // Adjust spacing
            const SPACING = 9;
            const px = 50 + SPACING * (q + r / 2);
            const py = 50 + SPACING * (r * 0.866); // sqrt(3)/2 approx

            const el = document.createElement('div');
            el.className = 'hole';
            el.style.left = `${px}%`;
            el.style.top = `${py}%`;
            el.dataset.q = q;
            el.dataset.r = r;

            el.addEventListener('click', () => handleHoleClick(q, r));

            boardEl.appendChild(el);
            holes.push({ q, r, el, piece: 0 });
        }

        function renderPieces() {
            holes.forEach(h => {
                h.el.innerHTML = '';
                if (h.piece > 0) {
                    const p = document.createElement('div');
                    p.className = `piece p${h.piece}`;
                    if (selectedHole && selectedHole.q === h.q && selectedHole.r === h.r) {
                        p.classList.add('selected');
                    }
                    h.el.appendChild(p);
                }
                h.el.classList.remove('highlight');
            });

            // Highlight valid moves if selected
            if (selectedHole) {
                const moves = getValidMoves(selectedHole);
                moves.forEach(m => {
                    const target = getHole(m.q, m.r);
                    if (target) target.el.classList.add('highlight');
                });
            }

            turnIndicator.textContent = `Player ${currentPlayer}'s Turn`;
            turnIndicator.className = `turn-indicator turn-p${currentPlayer}`;
        }

        function getHole(q, r) {
            return holes.find(h => h.q === q && h.r === r);
        }

        function handleHoleClick(q, r) {
            const clickedHole = getHole(q, r);

            // If selecting own piece
            if (clickedHole.piece === currentPlayer) {
                selectedHole = clickedHole;
                renderPieces();
                return;
            }

            // If moving to empty spot
            if (selectedHole && clickedHole.piece === 0) {
                const moves = getValidMoves(selectedHole);
                if (moves.some(m => m.q === q && m.r === r)) {
                    // Move
                    clickedHole.piece = currentPlayer;
                    selectedHole.piece = 0;
                    selectedHole = null;
                    currentPlayer = currentPlayer === 1 ? 2 : 1;
                    renderPieces();
                    checkWin();
                }
            }
        }

        function getValidMoves(startHole) {
            const moves = [];
            const directions = [
                { q: 1, r: 0 }, { q: -1, r: 0 },
                { q: 0, r: 1 }, { q: 0, r: -1 },
                { q: 1, r: -1 }, { q: -1, r: 1 }
            ];

            // Adjacent moves
            directions.forEach(d => {
                const nq = startHole.q + d.q;
                const nr = startHole.r + d.r;
                const target = getHole(nq, nr);
                if (target && target.piece === 0) {
                    moves.push({ q: nq, r: nr });
                }
            });

            // Jump moves (recursive?)
            // For simplicity, let's just implement single jumps for now, or simple multi-jumps.
            // Let's do single jumps over 1 piece.
            directions.forEach(d => {
                const adjQ = startHole.q + d.q;
                const adjR = startHole.r + d.r;
                const adj = getHole(adjQ, adjR);

                if (adj && adj.piece !== 0) {
                    const jumpQ = startHole.q + d.q * 2;
                    const jumpR = startHole.r + d.r * 2;
                    const jumpTarget = getHole(jumpQ, jumpR);

                    if (jumpTarget && jumpTarget.piece === 0) {
                        moves.push({ q: jumpQ, r: jumpR });
                    }
                }
            });

            return moves;
        }

        function checkWin() {
            // P1 starts at bottom (r >= 2), target is top (r <= -2)
            // P2 starts at top (r <= -2), target is bottom (r >= 2)
            
            const p1Pieces = holes.filter(h => h.piece === 1);
            const p2Pieces = holes.filter(h => h.piece === 2);
            
            const p1Win = p1Pieces.every(h => h.r <= -2);
            const p2Win = p2Pieces.every(h => h.r >= 2);

            if (p1Win) {
                GameInterface.showGameOver({
                    text: 'Player 1 Wins!',
                    score: 'Victory'
                });
            } else if (p2Win) {
                GameInterface.showGameOver({
                    text: 'Player 2 Wins!',
                    score: 'Victory'
                });
            }
        }

        document.getElementById('resetBtn').addEventListener('click', () => {
            currentPlayer = 1;
            selectedHole = null;
            initBoard();
        });

        initBoard();

    </script>
</body>

</html>