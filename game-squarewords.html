<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SquareWords - DATOV</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(21, 23, 37, 0.5);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            max-width: 500px;
            margin: 0 auto;
        }

        .board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 1rem;
        }

        .row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .tile {
            width: 50px;
            height: 50px;
            border: 2px solid #3a3a3c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            user-select: none;
            transition: transform 0.2s, background 0.4s, border-color 0.4s;
        }

        .tile[data-state="active"] {
            border-color: #565758;
        }

        .tile[data-state="correct"] {
            background: #538d4e;
            border-color: #538d4e;
        }

        .tile[data-state="present"] {
            background: #b59f3b;
            border-color: #b59f3b;
        }

        .tile[data-state="absent"] {
            background: #3a3a3c;
            border-color: #3a3a3c;
        }

        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .key-row {
            display: flex;
            justify-content: center;
            gap: 6px;
        }

        .key {
            font-size: 1.2rem;
            font-weight: bold;
            padding: 15px 10px;
            border-radius: 4px;
            background: #818384;
            color: #fff;
            cursor: pointer;
            user-select: none;
            min-width: 30px;
            text-align: center;
        }

        .key.wide {
            padding: 15px 20px;
        }

        .key:hover {
            background: #999;
        }

        .key[data-state="correct"] {
            background: #538d4e;
        }

        .key[data-state="present"] {
            background: #b59f3b;
        }

        .key[data-state="absent"] {
            background: #3a3a3c;
        }

        .message {
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            color: #000;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: bold;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .message.show {
            opacity: 1;
        }
    </style>
</head>

<body>

    <header class="header">
        <div class="container flex flex-between">
            <a href="index.html" class="logo">DATOV</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html#games">Back to Games</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="section" style="padding-top: 6rem;">
        <div class="container">
            <div class="game-container">
                <div class="board" id="board">
                    <!-- 6 rows of 5 tiles -->
                </div>

                <div class="keyboard" id="keyboard">
                    <!-- Keyboard generated by JS -->
                </div>
            </div>
        </div>
    </section>

    <div id="message" class="message"></div>

    <script src="game-interface.js"></script>
    <script>
        const boardEl = document.getElementById('board');
        const keyboardEl = document.getElementById('keyboard');
        const messageEl = document.getElementById('message');

        const WORD_LENGTH = 5;
        const MAX_GUESSES = 6;

        // Simple word list
        const WORDS = ['REACT', 'BUILD', 'CODE', 'WORLD', 'HELLO', 'SMART', 'GAMES', 'PIXEL', 'LOGIC', 'SPACE', 'ROBOT', 'LASER', 'POWER', 'LEVEL', 'SCORE'];
        // Pad 4 letter words or filter? Let's stick to 5 letter words for simplicity
        const TARGET_WORDS = WORDS.filter(w => w.length === 5);

        let targetWord = '';
        let currentGuess = '';
        let guesses = [];
        let gameOver = false;

        GameInterface.init({
            name: 'SquareWords',
            description: 'Guess the 5-letter word in 6 tries.',
            url: 'game-squarewords.html',
            howToPlay: [
                'Guess the 5-letter word.',
                'Green: Correct letter, correct spot.',
                'Yellow: Correct letter, wrong spot.',
                'Gray: Letter not in word.',
                'You have 6 tries.'
            ]
        });

        function initGame() {
            targetWord = TARGET_WORDS[Math.floor(Math.random() * TARGET_WORDS.length)];
            currentGuess = '';
            guesses = [];
            gameOver = false;
            createBoard();
            createKeyboard();
        }

        function createBoard() {
            boardEl.innerHTML = '';
            for (let i = 0; i < MAX_GUESSES; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.id = `tile-${i}-${j}`;
                    row.appendChild(tile);
                }
                boardEl.appendChild(row);
            }
        }

        function createKeyboard() {
            keyboardEl.innerHTML = '';
            const rows = [
                'QWERTYUIOP',
                'ASDFGHJKL',
                'ZXCVBNM'
            ];

            rows.forEach((rowStr, i) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'key-row';

                if (i === 2) {
                    // Enter key
                    const enterKey = createKey('ENTER', 'wide');
                    enterKey.onclick = submitGuess;
                    rowDiv.appendChild(enterKey);
                }

                rowStr.split('').forEach(char => {
                    const key = createKey(char, '');
                    key.onclick = () => handleInput(char);
                    rowDiv.appendChild(key);
                });

                if (i === 2) {
                    // Backspace key
                    const backKey = createKey('âŒ«', 'wide');
                    backKey.onclick = deleteChar;
                    rowDiv.appendChild(backKey);
                }

                keyboardEl.appendChild(rowDiv);
            });
        }

        function createKey(char, className) {
            const key = document.createElement('div');
            key.className = `key ${className}`;
            key.textContent = char;
            key.dataset.key = char;
            return key;
        }

        function handleInput(char) {
            if (gameOver) return;
            if (currentGuess.length < WORD_LENGTH) {
                currentGuess += char;
                updateBoard();
            }
        }

        function deleteChar() {
            if (gameOver) return;
            if (currentGuess.length > 0) {
                currentGuess = currentGuess.slice(0, -1);
                updateBoard();
            }
        }

        function submitGuess() {
            if (gameOver) return;
            if (currentGuess.length !== WORD_LENGTH) {
                showMessage('Not enough letters');
                return;
            }

            // In a real game, check if word exists in dictionary
            // For now, allow any 5 letters

            const row = guesses.length;
            guesses.push(currentGuess);

            // Check letters
            const result = checkWord(currentGuess);

            // Animate and color tiles
            result.forEach((status, i) => {
                const tile = document.getElementById(`tile-${row}-${i}`);
                setTimeout(() => {
                    tile.dataset.state = status;
                    tile.style.transform = 'rotateX(360deg)';

                    // Update keyboard
                    const key = document.querySelector(`.key[data-key="${currentGuess[i]}"]`);
                    if (key) {
                        const currentStatus = key.dataset.state;
                        if (status === 'correct' || (status === 'present' && currentStatus !== 'correct')) {
                            key.dataset.state = status;
                        } else if (status === 'absent' && !currentStatus) {
                            key.dataset.state = status;
                        }
                    }
                }, i * 100);
            });

            if (currentGuess === targetWord) {
                setTimeout(() => {
                    GameInterface.showGameOver({
                        text: 'Splendid!',
                        score: 'Win',
                        level: guesses.length + '/6'
                    });
                    gameOver = true;
                }, 2000);
            } else if (guesses.length === MAX_GUESSES) {
                setTimeout(() => {
                    GameInterface.showGameOver({
                        text: targetWord,
                        score: 'Lost',
                        level: '-'
                    });
                    gameOver = true;
                }, 2000);
            }

            currentGuess = '';
        }

        function checkWord(guess) {
            const result = Array(WORD_LENGTH).fill('absent');
            const targetArr = targetWord.split('');
            const guessArr = guess.split('');

            // First pass: Correct
            guessArr.forEach((char, i) => {
                if (char === targetArr[i]) {
                    result[i] = 'correct';
                    targetArr[i] = null; // Mark as used
                    guessArr[i] = null;
                }
            });

            // Second pass: Present
            guessArr.forEach((char, i) => {
                if (char && targetArr.includes(char)) {
                    result[i] = 'present';
                    targetArr[targetArr.indexOf(char)] = null;
                }
            });

            return result;
        }

        function updateBoard() {
            const row = guesses.length;
            for (let i = 0; i < WORD_LENGTH; i++) {
                const tile = document.getElementById(`tile-${row}-${i}`);
                tile.textContent = currentGuess[i] || '';
                tile.dataset.state = currentGuess[i] ? 'active' : '';
            }
        }

        function showMessage(msg) {
            messageEl.textContent = msg;
            messageEl.classList.add('show');
            setTimeout(() => messageEl.classList.remove('show'), 2000);
        }

        document.addEventListener('keydown', (e) => {
            if (gameOver) return;
            const key = e.key.toUpperCase();
            if (key === 'ENTER') submitGuess();
            else if (key === 'BACKSPACE') deleteChar();
            else if (/^[A-Z]$/.test(key)) handleInput(key);
        });

        initGame();

    </script>
</body>

</html>